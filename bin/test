#!/bin/bash
set -e

echo "ğŸ§ª Testing AllShared setup..."

# Check if containers are running
if ! docker-compose ps | grep -q "Up"; then
    echo "âŒ Containers are not running. Run ./bin/go first."
    exit 1
fi

# Test database connection
echo "ğŸ” Testing database connection..."
docker-compose exec -T web rails runner "puts 'Database connection: ' + (ActiveRecord::Base.connection.active? ? 'âœ… OK' : 'âŒ Failed')"

# Test esbuild is configured
echo "ğŸ” Testing esbuild configuration..."
if [ -f "app/javascript/application.js" ]; then
    echo "âœ… JavaScript entry point exists"
else
    echo "âŒ JavaScript entry point missing"
fi

# Test application starts
echo "ğŸ” Testing application response..."
if curl -s http://localhost:8888 > /dev/null; then
    echo "âœ… Application responding on port 8888"
else
    echo "âŒ Application not responding on port 8888"
fi

echo "ğŸ‰ Setup test complete!"
